/*! For license information please see fe6dc9838bf3040b3914.js.LICENSE.txt */
function _regenerator(){var e,n,t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",a=t.toStringTag||"@@toStringTag";function r(t,o,a,r){var c=o&&o.prototype instanceof i?o:i,l=Object.create(c.prototype);return _regeneratorDefine2(l,"_invoke",function(t,o,a){var r,i,c,l=0,d=a||[],u=!1,p={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(n,t){return r=n,i=0,c=e,p.n=t,s}};function f(t,o){for(i=t,c=o,n=0;!u&&l&&!a&&n<d.length;n++){var a,r=d[n],f=p.p,m=r[2];t>3?(a=m===o)&&(c=r[(i=r[4])?5:(i=3,3)],r[4]=r[5]=e):r[0]<=f&&((a=t<2&&f<r[1])?(i=0,p.v=o,p.n=r[1]):f<m&&(a=t<3||r[0]>o||o>m)&&(r[4]=t,r[5]=o,p.n=m,i=0))}if(a||t>1)return s;throw u=!0,o}return function(a,d,m){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&f(d,m),i=d,c=m;(n=i<2?e:c)||!u;){r||(i?i<3?(i>1&&(p.n=-1),f(i,c)):p.n=c:p.v=c);try{if(l=2,r){if(i||(a="next"),n=r[a]){if(!(n=n.call(r,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,i<2&&(i=0)}else 1===i&&(n=r.return)&&n.call(r),i<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),i=1);r=e}else if((n=(u=p.n<0)?c:t.call(o,p))!==s)break}catch(n){r=e,i=1,c=n}finally{l=1}}return{value:n,done:u}}}(t,a,r),!0),l}var s={};function i(){}function c(){}function l(){}n=Object.getPrototypeOf;var d=[][o]?n(n([][o]())):(_regeneratorDefine2(n={},o,function(){return this}),n),u=l.prototype=i.prototype=Object.create(d);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,_regeneratorDefine2(e,a,"GeneratorFunction")),e.prototype=Object.create(u),e}return c.prototype=l,_regeneratorDefine2(u,"constructor",l),_regeneratorDefine2(l,"constructor",c),c.displayName="GeneratorFunction",_regeneratorDefine2(l,a,"GeneratorFunction"),_regeneratorDefine2(u),_regeneratorDefine2(u,a,"Generator"),_regeneratorDefine2(u,o,function(){return this}),_regeneratorDefine2(u,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:r,m:p}})()}function _regeneratorDefine2(e,n,t,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}_regeneratorDefine2=function(e,n,t,o){function r(n,t){_regeneratorDefine2(e,n,function(e){return this._invoke(n,t,e)})}n?a?a(e,n,{value:t,enumerable:!o,configurable:!o,writable:!o}):e[n]=t:(r("next",0),r("throw",1),r("return",2))},_regeneratorDefine2(e,n,t,o)}function asyncGeneratorStep(e,n,t,o,a,r,s){try{var i=e[r](s),c=i.value}catch(e){return void t(e)}i.done?n(c):Promise.resolve(c).then(o,a)}function _asyncToGenerator(e){return function(){var n=this,t=arguments;return new Promise(function(o,a){var r=e.apply(n,t);function s(e){asyncGeneratorStep(r,o,a,s,i,"next",e)}function i(e){asyncGeneratorStep(r,o,a,s,i,"throw",e)}s(void 0)})}}function initChatInterface(){var e=document.getElementById("chat-input"),n=document.getElementById("chat-send-btn");e&&n&&(n.addEventListener("click",handleChatSend),e.addEventListener("keypress",function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),handleChatSend())}),e.addEventListener("input",function(){var n=document.getElementById("chat-send-btn"),t=e.value.trim().length>0;n.disabled=!t}))}function resetAIChatInterface(){var e=document.getElementById("chat-messages"),n=document.getElementById("chat-input"),t=document.getElementById("chat-send-btn");if(e){e.innerHTML="";var o=document.createElement("div");o.className="message ai-message",o.innerHTML='\n      <div class="message-content">\n        Hello! What would you like to do today? \n        <br><br>You can say something like:\n        <br>‚Ä¢ "I want to do Phase II study cost analysis for study SK123-kbi"\n        <br>‚Ä¢ "Help me estimate costs for an oncology trial (study number: ABC-123)"\n        <br>‚Ä¢ "I need SDTM mapping for study SK123-kbi protocol"\n      </div>\n    ',e.appendChild(o)}n&&(n.value=""),t&&(t.disabled=!0),pendingConfirmation=null,lastParsedCommand=null,console.log("‚úÖ AIËÅäÂ§©ÁïåÈù¢Â∑≤ÈáçÁΩÆÂà∞ÂàùÂßãÁä∂ÊÄÅ")}function addActionBubble(e,n){var t=document.getElementById("chat-messages"),o=document.createElement("div");o.className="message ai-message",o.innerHTML='\n    <div class="message-content">\n      <button class="ms-Button ms-Button--primary" data-action-id="'.concat(n,'">\n        <span class="ms-Button-label">').concat(e,"</span>\n      </button>\n    </div>"),t.appendChild(o),t.scrollTop=t.scrollHeight}function handleChatSend(){return _handleChatSend.apply(this,arguments)}function _handleChatSend(){return(_handleChatSend=_asyncToGenerator(_regenerator().m(function e(){var n,t,o,a,r;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=document.getElementById("chat-input"),t=n.value.trim()){e.n=1;break}return e.a(2);case 1:if(addChatMessage(t,"user"),n.value="",document.getElementById("chat-send-btn").disabled=!0,!pendingConfirmation){e.n=3;break}return e.n=2,handleConfirmationResponse(t);case 2:return e.a(2);case 3:return showTypingIndicator(),e.p=4,e.n=5,callAssistantParseCommand(t);case 5:if(o=e.v,hideTypingIndicator(),o&&(o.studyIdentifier||o.matchedTask)){e.n=7;break}if(!(t.toLowerCase().includes("start")||t.toLowerCase().includes("new project")||t.toLowerCase().includes("upload"))){e.n=6;break}return addChatMessage("Let me take you to start a new project by uploading your protocol.","ai"),addActionBubble("Click to upload protocol","navigate_to_upload"),e.a(2);case 6:return addChatMessage("I couldn't understand the study number or task. Supported tasks are: Cost Estimate, SAS Analysis. Please try e.g. 'I want to do Cost Estimate for study SK123-KBI', or say 'start new project'.","ai"),e.a(2);case 7:lastParsedCommand=o,a=o.studyIdentifier?o.studyIdentifier:"(study number not provided)",r=o.matchedTask?o.matchedTask.name:"(task not recognized)",askForConfirmation(a,r,o.matchedTask?o.matchedTask.key:null),e.n=9;break;case 8:e.p=8,e.v,hideTypingIndicator(),addChatMessage("Sorry, parsing failed. Please try again, or click below to upload a protocol.","ai"),addActionBubble("Click to upload protocol","navigate_to_upload");case 9:return e.a(2)}},e,null,[[4,8]])}))).apply(this,arguments)}function callAssistantParseCommand(e){return _callAssistantParseCommand.apply(this,arguments)}function _callAssistantParseCommand(){return(_callAssistantParseCommand=_asyncToGenerator(_regenerator().m(function e(n){var t,o;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("".concat(moduleConfig.API_BASE_URL,"/api/v2/parse-command"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:n})});case 1:if((t=e.v).ok){e.n=2;break}throw new Error("parse failed");case 2:return e.n=3,t.json();case 3:return o=e.v,e.a(2,(null==o?void 0:o.data)||null)}},e)}))).apply(this,arguments)}function askForConfirmation(e,n,t){addChatMessage("Did you mean you want ".concat(n," for study ").concat(e,"?"),"ai"),pendingConfirmation={studyIdentifier:e,taskName:n,taskKey:t}}function handleConfirmationResponse(e){return _handleConfirmationResponse.apply(this,arguments)}function _handleConfirmationResponse(){return(_handleConfirmationResponse=_asyncToGenerator(_regenerator().m(function e(n){var t,o,a,r,s,i,c;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if("yes"!==(t=parseYesNoIntent(n))){e.n=10;break}if(a=(o=pendingConfirmation).studyIdentifier,r=o.taskKey,pendingConfirmation=null,r){e.n=1;break}return addChatMessage("Task not recognized. Supported tasks: Cost Estimate, SAS Analysis. Please rephrase your request.","ai"),e.a(2);case 1:return showTypingIndicator(),e.p=2,e.n=3,callAssistantLookupStudyTask(a,r);case 3:return s=e.v,hideTypingIndicator(),e.p=4,e.n=5,handleLookupResult(s);case 5:e.n=7;break;case 6:e.p=6,i=e.v,console.error("HandleLookupResult error:",i);case 7:e.n=9;break;case 8:return e.p=8,c=e.v,hideTypingIndicator(),console.error("Lookup API error:",c),addChatMessage("We could not find the corresponding study.","ai"),e.n=9,safeDelayedNavigation(2);case 9:e.n=11;break;case 10:"no"===t?(pendingConfirmation=null,addChatMessage("Please tell me again what you want to do. For example: 'I want to do Cost Estimate for study SK123-KBI'.","ai")):addChatMessage("Please answer 'yes' or 'no'.","ai");case 11:document.getElementById("chat-send-btn").disabled=!1;case 12:return e.a(2)}},e,null,[[4,6],[2,8]])}))).apply(this,arguments)}function parseYesNoIntent(e){var n=e.toLowerCase().trim();return["yes","y","yeah","yep","correct","right","true","ok","okay","sure","exactly","that's right","confirm","confirmed","agreed"].some(function(e){return n.includes(e)})?"yes":["no","n","nope","wrong","incorrect","false","not right","not correct","that's wrong","cancel","redo"].some(function(e){return n.includes(e)})?"no":"unclear"}function callAssistantLookupStudyTask(e,n){return _callAssistantLookupStudyTask.apply(this,arguments)}function _callAssistantLookupStudyTask(){return(_callAssistantLookupStudyTask=_asyncToGenerator(_regenerator().m(function e(n,t){var o,a;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return console.log("üîç [DEBUG] API Call - lookup study task:"),console.log("  - studyIdentifier:",n),console.log("  - taskKey:",t),console.log("  - API_BASE_URL:",moduleConfig.API_BASE_URL),e.n=1,fetch("".concat(moduleConfig.API_BASE_URL,"/api/v2/lookup-study-task"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studyIdentifier:n,taskKey:t})});case 1:if(o=e.v,console.log("üîç [DEBUG] API Response status:",o.status),o.ok){e.n=2;break}throw new Error("lookup failed");case 2:return e.n=3,o.json();case 3:return a=e.v,console.log("üîç [DEBUG] API Response data:",JSON.stringify(a,null,2)),e.a(2,(null==a?void 0:a.data)||null)}},e)}))).apply(this,arguments)}function getTargetStepByStatus(e,n){if("costEstimate"!==n)return"sasAnalysis"===n||console.warn("‚ö†Ô∏è Unknown taskKey: '".concat(n,"', defaulting to Step 3")),3;switch(e){case null:case void 0:return 3;case"project_selection_done":return 4;case"sdtm_ai_analysis_done":return 5;case"user_confirmed_sdtm_done":return 6;default:return console.warn("‚ö†Ô∏è Unknown status: '".concat(e,"', defaulting to Step 3")),3}}function handleLookupResult(e){return _handleLookupResult.apply(this,arguments)}function _handleLookupResult(){return(_handleLookupResult=_asyncToGenerator(_regenerator().m(function e(n){var t;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(console.log("üîç [DEBUG] handleLookupResult received data:",JSON.stringify(n,null,2)),n&&!1!==n.foundStudy){e.n=1;break}return console.log("üîç [DEBUG] Study not found, offering upload action in chat"),addChatMessage("We could not find the corresponding study.","ai"),addActionBubble("Click to upload protocol","navigate_to_upload"),e.a(2);case 1:if(null!==n.isUnfinished){e.n=7;break}if("costEstimate"!==n.taskKey){e.n=4;break}return addChatMessage("Starting Cost Estimate for study ".concat(n.studyNumber,"..."),"ai"),safeSetCurrentDocumentId(n.documentId),e.n=2,safeSaveDocumentIdToSettings(n.documentId);case 2:return e.n=3,safeDelayedNavigation(3);case 3:e.n=6;break;case 4:if("sasAnalysis"!==n.taskKey){e.n=6;break}return addChatMessage("Starting SAS Analysis for study ".concat(n.studyNumber,"..."),"ai"),safeSetCurrentDocumentId(n.documentId),e.n=5,safeSaveDocumentIdToSettings(n.documentId);case 5:return e.n=6,safeDelayedNavigation(3);case 6:return e.a(2);case 7:if(!0!==n.isUnfinished||!n.documentId){e.n=16;break}return console.log("üîç [DEBUG] Found unfinished task:"),console.log("  - taskKey:",n.taskKey),console.log("  - currentStatus:",n.currentStatus),console.log("  - documentId:",n.documentId),addChatMessage("I found an unfinished '".concat(n.taskName,"' for study '").concat(n.studyNumber,"'. Continuing from where you left off..."),"ai"),safeSetCurrentDocumentId(n.documentId),e.n=8,safeSaveDocumentIdToSettings(n.documentId);case 8:if(t=getTargetStepByStatus(n.currentStatus,n.taskKey),console.log("üìç [DEBUG] Status: '".concat(n.currentStatus,"' ‚Üí Routing to Step ").concat(t)),4!==t||"costEstimate"!==n.taskKey){e.n=10;break}return e.n=9,safeDelayedNavigation(t);case 9:setTimeout(_asyncToGenerator(_regenerator().m(function e(){var n;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!window.triggerSDTMAnalysis||"function"!=typeof window.triggerSDTMAnalysis){e.n=2;break}return console.log("üîÑ Ëá™Âä®Ëß¶ÂèëSDTMÂàÜÊûêÔºà‰ªéÁä∂ÊÄÅÊÅ¢Â§çÔºâ..."),e.n=1,window.triggerSDTMAnalysis();case 1:e.n=3;break;case 2:console.warn("‚ö†Ô∏è triggerSDTMAnalysisÂáΩÊï∞‰∏çÂèØÁî®");case 3:e.n=5;break;case 4:e.p=4,n=e.v,console.error("‚ùå Ëá™Âä®Ëß¶ÂèëSDTMÂàÜÊûêÂ§±Ë¥•:",n);case 5:return e.a(2)}},e,null,[[0,4]])})),1e3),e.n=15;break;case 10:if(5!==t||"costEstimate"!==n.taskKey){e.n=12;break}return e.n=11,safeDelayedNavigation(t);case 11:setTimeout(_asyncToGenerator(_regenerator().m(function e(){var n;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!window.CostEstimateModule||!window.CostEstimateModule.loadAndDisplaySDTMResults){e.n=2;break}return console.log("üîÑ Ëá™Âä®Âä†ËΩΩSDTMÂàÜÊûêÁªìÊûúÔºà‰ªéÁä∂ÊÄÅÊÅ¢Â§çÔºâ..."),e.n=1,window.CostEstimateModule.loadAndDisplaySDTMResults();case 1:e.n=3;break;case 2:console.warn("‚ö†Ô∏è loadAndDisplaySDTMResultsÂáΩÊï∞‰∏çÂèØÁî®");case 3:e.n=5;break;case 4:e.p=4,n=e.v,console.error("‚ùå Ëá™Âä®Âä†ËΩΩSDTMÁªìÊûúÂ§±Ë¥•:",n);case 5:return e.a(2)}},e,null,[[0,4]])})),1e3),e.n=15;break;case 12:if(6!==t||"costEstimate"!==n.taskKey){e.n=14;break}return e.n=13,safeDelayedNavigation(t);case 13:setTimeout(_asyncToGenerator(_regenerator().m(function e(){var n;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!window.CostEstimateModule||!window.CostEstimateModule.loadAndDisplaySDTMResults){e.n=2;break}return console.log("üîÑ ÊÅ¢Â§çÂÆåÊàêÈ°πÁõÆÁöÑExcelË°®Ê†ºÔºàStep 6Ôºâ..."),e.n=1,window.CostEstimateModule.loadAndDisplaySDTMResults();case 1:e.n=3;break;case 2:console.warn("‚ö†Ô∏è loadAndDisplaySDTMResultsÂáΩÊï∞‰∏çÂèØÁî®");case 3:e.n=5;break;case 4:e.p=4,n=e.v,console.error("‚ùå ÊÅ¢Â§çStep 6 ExcelË°®Ê†ºÂ§±Ë¥•:",n);case 5:return e.a(2)}},e,null,[[0,4]])})),1e3),e.n=15;break;case 14:return e.n=15,safeDelayedNavigation(t);case 15:return e.a(2);case 16:!1===n.isUnfinished?addChatMessage("The '".concat(n.taskName,"' for study '").concat(n.studyNumber,"' is already completed."),"ai"):addChatMessage("We could not check the status for this study.","ai");case 17:return e.a(2)}},e)}))).apply(this,arguments)}function addChatMessage(e,n){var t=document.getElementById("chat-messages"),o=document.createElement("div");o.className="message ".concat(n,"-message");var a=document.createElement("div");a.className="message-content",a.innerHTML=e,o.appendChild(a),t.appendChild(o),t.scrollTop=t.scrollHeight}function showTypingIndicator(){var e=document.getElementById("chat-messages"),n=document.createElement("div");n.className="message ai-message",n.innerHTML='\n    <div class="typing-indicator">\n      <span class="dot"></span>\n      <span class="dot"></span>\n      <span class="dot"></span>\n    </div>\n  ',n.id="typing-indicator",e.appendChild(n),e.scrollTop=e.scrollHeight}function hideTypingIndicator(){var e=document.getElementById("typing-indicator");e&&e.remove()}function initFileUpload(){var e=document.getElementById("protocol-select-btn"),n=document.getElementById("protocol-file-input"),t=document.getElementById("protocol-upload-area"),o=document.getElementById("protocol-cancel-btn"),a=document.getElementById("protocol-remove-btn");e&&e.addEventListener("click",function(){return n.click()}),t&&t.addEventListener("click",function(){return n.click()}),n&&n.addEventListener("change",function(e){return handleProtocolUpload(e.target.files[0])}),o&&o.addEventListener("click",cancelProtocolUpload),a&&a.addEventListener("click",removeProtocolFile),t&&(t.addEventListener("dragover",handleDragOver),t.addEventListener("drop",function(e){return handleProtocolDrop(e)}),t.addEventListener("dragenter",handleDragEnter),t.addEventListener("dragleave",handleDragLeave))}function handleDragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="copy"}function handleDragEnter(e){e.preventDefault(),e.currentTarget.classList.add("dragover")}function handleDragLeave(e){e.preventDefault(),e.currentTarget.classList.remove("dragover")}function handleProtocolDrop(e){e.preventDefault(),e.currentTarget.classList.remove("dragover");var n=e.dataTransfer.files;n.length>0&&handleProtocolUpload(n[0])}function handleProtocolUpload(e){return _handleProtocolUpload.apply(this,arguments)}function _handleProtocolUpload(){return(_handleProtocolUpload=_asyncToGenerator(_regenerator().m(function e(n){var t,o,a,r,s,i;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n){e.n=1;break}return e.a(2);case 1:if(["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(n.type)){e.n=2;break}return moduleConfig.showStatusMessage("Please select PDF or Word documents only","error"),e.a(2);case 2:return showProtocolProgress(),e.p=3,(t=new FormData).append("document",n),t.append("documentType","ClinicalProtocol"),e.n=4,fetch("".concat(moduleConfig.API_BASE_URL,"/api/upload-document"),{method:"POST",body:t});case 4:if((o=e.v).ok){e.n=5;break}throw new Error("Upload failed: ".concat(o.statusText));case 5:return e.n=6,o.json();case 6:if(a=e.v,safeSetUploadedProtocol({name:n.name,size:n.size,type:n.type,uploadId:a.uploadId}),!a.uploadId){e.n=7;break}return safeSetCurrentDocumentId(a.uploadId),e.n=7,safeSaveDocumentIdToSettings(a.uploadId);case 7:showProtocolResult(n),"undefined"!=typeof window&&"from_chat"===window.uploadContext?(document.getElementById("protocol-finish-btn")||(r=document.getElementById("mainpage-step2-container"),(s=document.createElement("button")).id="protocol-finish-btn",s.className="ms-Button ms-Button--primary",s.innerHTML='<span class="ms-Button-label">Upload Finished</span>',s.style.marginTop="15px",s.style.display="block",s.style.marginLeft="auto",s.style.marginRight="auto",s.style.fontSize="16px",s.style.padding="12px 24px",s.style.minWidth="160px",s.style.transform="scale(1.2)",s.style.borderRadius="8px",s.addEventListener("click",function(){try{window.uploadContext="default"}catch(e){}moduleConfig&&"function"==typeof moduleConfig.showStep?moduleConfig.showStep(1):"function"==typeof window.showStep&&window.showStep(1),setTimeout(function(){try{addChatMessage("‚úÖ Your protocol has been uploaded successfully! I can access the document now.","ai")}catch(e){console.log("post-upload chat message failed:",e)}},200)}),r&&r.appendChild(s)),moduleConfig.showStatusMessage('Clinical Protocol uploaded. Click "Upload Finished" to return to chat.',"success")):moduleConfig.showStatusMessage("Clinical Protocol uploaded. Click Next to select projects.","success"),e.n=9;break;case 8:e.p=8,i=e.v,console.error("Protocol upload error:",i),moduleConfig.showStatusMessage("Upload failed: ".concat(i.message),"error"),hideProtocolProgress();case 9:return e.a(2)}},e,null,[[3,8]])}))).apply(this,arguments)}function showProtocolProgress(){var e=document.getElementById("protocol-upload-area"),n=document.getElementById("protocol-progress"),t=document.getElementById("protocol-result");e&&(e.style.display="none"),n&&(n.style.display="block"),t&&(t.style.display="none")}function hideProtocolProgress(){var e=document.getElementById("protocol-upload-area"),n=document.getElementById("protocol-progress");e&&(e.style.display="block"),n&&(n.style.display="none")}function showProtocolResult(e){var n=document.getElementById("protocol-upload-area"),t=document.getElementById("protocol-progress"),o=document.getElementById("protocol-result"),a=document.getElementById("protocol-file-name"),r=document.getElementById("protocol-file-status");n&&(n.style.display="none"),t&&(t.style.display="none"),o&&(o.style.display="block"),a&&(a.textContent=e.name),r&&(r.textContent="‚úÖ Clinical Protocol uploaded to MongoDB")}function cancelProtocolUpload(){hideProtocolProgress(),moduleConfig.showStatusMessage("Protocol upload cancelled","info")}function removeProtocolFile(){return _removeProtocolFile.apply(this,arguments)}function _removeProtocolFile(){return(_removeProtocolFile=_asyncToGenerator(_regenerator().m(function e(){var n,t,o;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:safeSetUploadedProtocol(null),safeSetCurrentDocumentId(null),n=document.getElementById("protocol-upload-area"),t=document.getElementById("protocol-result"),o=document.getElementById("protocol-file-input"),n&&(n.style.display="block"),t&&(t.style.display="none"),o&&(o.value=""),moduleConfig.showStatusMessage("Protocol file removed","info");case 1:return e.a(2)}},e)}))).apply(this,arguments)}document.addEventListener("click",function(e){var n=e.target.closest("[data-action-id]");if(n&&"navigate_to_upload"===n.getAttribute("data-action-id")){try{window.uploadContext="from_chat"}catch(e){}moduleConfig&&"function"==typeof moduleConfig.showStep?moduleConfig.showStep(2):"function"==typeof window.showStep&&window.showStep(2)}});var moduleConfig={};function safeDelayedNavigation(e){return _safeDelayedNavigation.apply(this,arguments)}function _safeDelayedNavigation(){return _safeDelayedNavigation=_asyncToGenerator(_regenerator().m(function e(n){var t,o,a=arguments;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(t=a.length>1&&void 0!==a[1]?a[1]:2e3,"function"!=typeof(o=moduleConfig&&moduleConfig.delayedNavigation)){e.n=1;break}return e.a(2,o(n,t));case 1:if(!t){e.n=2;break}return e.n=2,new Promise(function(e){return setTimeout(e,t)});case 2:if(!moduleConfig||"function"!=typeof moduleConfig.showStep){e.n=3;break}return e.a(2,moduleConfig.showStep(n));case 3:if("undefined"==typeof window||"function"!=typeof window.showStep){e.n=4;break}return e.a(2,window.showStep(n));case 4:console.warn("Navigation fallback could not find showStep; targetStep =",n);case 5:return e.a(2)}},e)})),_safeDelayedNavigation.apply(this,arguments)}function safeSetUploadedProtocol(e){var n=moduleConfig&&moduleConfig.setUploadedProtocol;if("function"==typeof n)try{return n(e)}catch(e){console.warn("moduleConfig.setUploadedProtocol failed:",e)}try{if("undefined"!=typeof window)return window.uploadedProtocol=e,void console.log("fallback: set window.uploadedProtocol =",e)}catch(e){console.warn("fallback set window.uploadedProtocol failed:",e)}console.warn("No way to set uploadedProtocol; value =",e)}function safeSetCurrentDocumentId(e){var n=moduleConfig&&moduleConfig.setCurrentDocumentId;if("function"==typeof n)try{return n(e)}catch(e){console.warn("moduleConfig.setCurrentDocumentId failed:",e)}try{"undefined"!=typeof window&&(window.currentDocumentId=e,console.log("fallback: set window.currentDocumentId =",e))}catch(e){console.warn("fallback set window.currentDocumentId failed:",e)}}function safeSaveDocumentIdToSettings(e){return _safeSaveDocumentIdToSettings.apply(this,arguments)}function _safeSaveDocumentIdToSettings(){return(_safeSaveDocumentIdToSettings=_asyncToGenerator(_regenerator().m(function e(n){var t,o;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if("function"!=typeof(t=moduleConfig&&moduleConfig.saveDocumentIdToSettings)){e.n=4;break}return e.p=1,e.n=2,t(n);case 2:return e.a(2,e.v);case 3:e.p=3,o=e.v,console.warn("moduleConfig.saveDocumentIdToSettings failed:",o);case 4:console.warn("saveDocumentIdToSettings not available; documentId =",n);case 5:return e.a(2)}},e,null,[[1,3]])}))).apply(this,arguments)}var pendingConfirmation=null;function insertMainPageHTML(){var e=document.getElementById("mainpage-step1-container");e&&(e.innerHTML='\n      <div class="mainpage-step1">\n        <h3 class="ms-font-l">ü§ñ AI Assistant</h3>\n        \n        \x3c!-- Chat Interface --\x3e\n        <div class="chat-container" id="chat-container">\n          <div class="chat-messages" id="chat-messages">\n            <div class="message ai-message">\n              <div class="message-content">\n                Hello! What would you like to do today? \n                <br><br>You can say something like:\n                <br>‚Ä¢ "I want to do Phase II study cost analysis for study SK123-kbi"\n                <br>‚Ä¢ "Help me estimate costs for an oncology trial (study number: ABC-123)"\n                <br>‚Ä¢ "I need SDTM mapping for study SK123-kbi protocol"\n              </div>\n            </div>\n          </div>\n          \n          <div class="chat-input-area">\n            <div class="input-group">\n              <input type="text" \n                     id="chat-input" \n                     class="chat-input" \n                     placeholder="e.g. I want to do Phase II study cost analysis for study SK123-kbi" \n                     maxlength="500">\n              <button id="chat-send-btn" class="chat-send-btn">\n                <span class="ms-Icon ms-Icon--Send"></span>\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    ');var n=document.getElementById("mainpage-step2-container");n&&(n.innerHTML='\n      <div class="mainpage-step2">\n        <h3 class="ms-font-l">üìã Protocol Upload</h3>\n        <div class="upload-area" id="protocol-upload-area" style="min-height: 120px; padding: 20px 24px;">\n          <div class="upload-content">\n            <i class="ms-Icon ms-Icon--CloudUpload ms-font-xxl upload-icon"></i>\n            <h4 class="ms-font-l">Upload Protocol Document</h4>\n            <p class="ms-font-m">Support PDF and Word documents</p>\n            <div class="ms-Button ms-Button--primary" id="protocol-select-btn">\n              <span class="ms-Button-label">Select File</span>\n            </div>\n            <input type="file" id="protocol-file-input" accept=".pdf,.doc,.docx" style="display: none;">\n          </div>\n        </div>\n\n        \x3c!-- Upload Progress --\x3e\n        <div class="upload-progress" id="protocol-progress" style="display: none;">\n          <div class="ms-Spinner">\n            <div class="ms-Spinner-circle ms-Spinner-circle--large"></div>\n          </div>\n          <p class="ms-font-m" id="protocol-progress-text">Uploading protocol...</p>\n          <div class="ms-Button" id="protocol-cancel-btn">\n            <span class="ms-Button-label">Cancel Upload</span>\n          </div>\n        </div>\n\n        \x3c!-- Upload Result --\x3e\n        <div class="upload-result" id="protocol-result" style="display: none;">\n          <div class="file-info">\n            <i class="ms-Icon ms-Icon--Document ms-font-l file-icon"></i>\n            <div class="file-details">\n              <span class="file-name" id="protocol-file-name">filename.pdf</span>\n              <span class="file-status" id="protocol-file-status">‚úÖ Uploaded successfully</span>\n            </div>\n            <div class="file-actions">\n              <div class="ms-Button ms-Button--secondary" id="protocol-remove-btn">\n                <span class="ms-Button-label">Remove</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    ')}function initMainPageModule(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log("üöÄ ÂàùÂßãÂåñ mainpage Ê®°Âùó..."),"function"!=typeof(moduleConfig={API_BASE_URL:e.API_BASE_URL||"https://localhost:4000",showStep:e.showStep||function(){return console.warn("showStep not provided")},showStatusMessage:e.showStatusMessage||function(e,n){return console.warn("showStatusMessage not provided:",e)},delayedNavigation:e.delayedNavigation||function(){return console.warn("delayedNavigation not provided")},saveDocumentIdToSettings:e.saveDocumentIdToSettings||function(){return console.warn("saveDocumentIdToSettings not provided")},setCurrentDocumentId:e.setCurrentDocumentId||function(){return console.warn("setCurrentDocumentId not provided")},setUploadedProtocol:e.setUploadedProtocol||function(){return console.warn("setUploadedProtocol not provided")}}).delayedNavigation&&(moduleConfig.delayedNavigation=function(){var e=_asyncToGenerator(_regenerator().m(function e(n){var t,o=arguments;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=o.length>1&&void 0!==o[1]?o[1]:2e3,e.p=1,e.n=2,new Promise(function(e){return setTimeout(e,t)});case 2:return e.p=2,"function"==typeof moduleConfig.showStep?moduleConfig.showStep(n):console.warn("showStep not available to navigate to step:",n),e.f(2);case 3:return e.a(2)}},e,null,[[1,,2,3]])}));return function(n){return e.apply(this,arguments)}}()),insertMainPageHTML(),initChatInterface(),initFileUpload(),console.log("‚úÖ mainpage Ê®°ÂùóÂàùÂßãÂåñÂÆåÊàê")}function resetMainPageModule(){console.log("üîÑ ÈáçÁΩÆ mainpage Ê®°Âùó..."),pendingConfirmation=null,resetAIChatInterface(),removeProtocolFile(),console.log("‚úÖ mainpage Ê®°ÂùóÈáçÁΩÆÂÆåÊàê")}"undefined"!=typeof window&&(window.MainPageModule={init:initMainPageModule,reset:resetMainPageModule,initChatInterface:initChatInterface,initFileUpload:initFileUpload,resetAIChatInterface:resetAIChatInterface,handleChatSend:handleChatSend,handleProtocolUpload:handleProtocolUpload});