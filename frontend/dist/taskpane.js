/*! For license information please see taskpane.js.LICENSE.txt */
!function(){var e={58394:function(e,t,n){"use strict";e.exports=n.p+"e7141a9036eb55328767.css"}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.m=e,n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=r[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),n.b=document.baseURI||self.location.href,function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?t(Object(o),!0).forEach(function(t){r(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function r(t,n,r){return(n=function(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function o(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,i=[],s=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);s=!0);}catch(e){u=!0,o=e}finally{try{if(!s&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(u)throw o}}return i}}(e,t)||c(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var s=r&&r.prototype instanceof i?r:i,l=Object.create(s.prototype);return u(l,"_invoke",function(n,r,o){var a,i,s,u=0,l=o||[],d=!1,m={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return a=t,i=0,s=e,m.n=n,c}};function f(n,r){for(i=n,s=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],f=m.p,p=a[2];n>3?(o=p===r)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=n<2&&f<a[1])?(i=0,m.v=r,m.n=a[1]):f<p&&(o=n<3||a[0]>r||r>p)&&(a[4]=n,a[5]=r,m.n=p,i=0))}if(o||n>1)return c;throw d=!0,r}return function(o,l,p){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&f(l,p),i=l,s=p;(t=i<2?e:s)||!d;){a||(i?i<3?(i>1&&(m.n=-1),f(i,s)):m.n=s:m.v=s);try{if(u=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=m.n<0)?s:n.call(r,m))!==c)break}catch(t){a=e,i=1,s=t}finally{u=1}}return{value:t,done:d}}}(n,o,a),!0),l}var c={};function i(){}function l(){}function d(){}t=Object.getPrototypeOf;var m=[][r]?t(t([][r]())):(u(t={},r,function(){return this}),t),f=d.prototype=i.prototype=Object.create(m);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,u(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=d,u(f,"constructor",d),u(d,"constructor",l),l.displayName="GeneratorFunction",u(d,o,"GeneratorFunction"),u(f),u(f,o,"Generator"),u(f,r,function(){return this}),u(f,"toString",function(){return"[object Generator]"}),(s=function(){return{w:a,m:p}})()}function u(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}u=function(e,t,n,r){function a(t,n){u(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},u(e,t,n,r)}function l(e,t,n,r,o,a,c){try{var i=e[a](c),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,o)}function d(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function c(e){l(a,r,o,c,i,"next",e)}function i(e){l(a,r,o,c,i,"throw",e)}c(void 0)})}}var m="https://localhost:4000",f=1;function p(){var e,t,n=document.getElementById("wizard-back-btn"),r=document.getElementById("wizard-next-btn");n.addEventListener("click",d(s().m(function e(){return s().w(function(e){for(;;)switch(e.n){case 0:3===f?L(1):f>1&&L(f-1);case 1:return e.a(2)}},e)}))),r.addEventListener("click",d(s().m(function e(){return s().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,R();case 1:return e.a(2)}},e)}))),e=document.getElementById("chat-input"),t=document.getElementById("chat-send-btn"),e&&t&&(t.addEventListener("click",y),e.addEventListener("keypress",function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),y())}),e.addEventListener("input",function(){var t=document.getElementById("chat-send-btn"),n=e.value.trim().length>0;t.disabled=!n})),L(1)}function y(){return g.apply(this,arguments)}function g(){return(g=d(s().m(function e(){var t,n,r,o,a;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=document.getElementById("chat-input"),n=t.value.trim()){e.n=1;break}return e.a(2);case 1:if(M(n,"user"),t.value="",document.getElementById("chat-send-btn").disabled=!0,!window.pendingConfirmation){e.n=3;break}return e.n=2,w(n);case 2:return e.a(2);case 3:return U(),e.p=4,e.n=5,h(n);case 5:if(r=e.v,j(),r&&(r.studyIdentifier||r.matchedTask)){e.n=8;break}if(!(n.toLowerCase().includes("start")||n.toLowerCase().includes("new project")||n.toLowerCase().includes("upload"))){e.n=7;break}return M("Let me take you to start a new project by uploading your protocol.","ai"),e.n=6,C(3);case 6:return e.a(2);case 7:return M("I couldn't understand the study number or task. Supported tasks are: Cost Estimate, SAS Analysis. Please try e.g. 'I want to do Cost Estimate for study SK123-KBI', or say 'start new project'.","ai"),e.a(2);case 8:o=r.studyIdentifier?r.studyIdentifier:"(study number not provided)",a=r.matchedTask?r.matchedTask.name:"(task not recognized)",b(o,a,r.matchedTask?r.matchedTask.key:null),e.n=10;break;case 9:e.p=9,e.v,j(),M('Sorry, parsing failed. Please try again, or say "start new project" to proceed with upload.',"ai");case 10:return e.a(2)}},e,null,[[4,9]])}))).apply(this,arguments)}function h(e){return v.apply(this,arguments)}function v(){return(v=d(s().m(function e(t){var n,r;return s().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("".concat(m,"/api/v2/parse-command"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t})});case 1:if((n=e.v).ok){e.n=2;break}throw new Error("parse failed");case 2:return e.n=3,n.json();case 3:return r=e.v,e.a(2,(null==r?void 0:r.data)||null)}},e)}))).apply(this,arguments)}function b(e,t,n){M("Did you mean you want ".concat(t," for study ").concat(e,"?"),"ai"),window.pendingConfirmation={studyIdentifier:e,taskName:t,taskKey:n}}function w(e){return k.apply(this,arguments)}function k(){return(k=d(s().m(function e(t){var n,r,o,a,c;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:return U(),e.p=1,e.n=2,E(t);case 2:if(n=e.v,j(),"yes"!==n){e.n=9;break}if(r=window.pendingConfirmation,o=r.studyIdentifier,a=r.taskKey){e.n=3;break}return M("Task not recognized. Supported tasks: Cost Estimate, SAS Analysis. Please rephrase your request.","ai"),window.pendingConfirmation=null,e.a(2);case 3:return U(),e.p=4,e.n=5,S(o,a);case 5:return c=e.v,j(),window.pendingConfirmation=null,e.n=6,x(c);case 6:e.n=8;break;case 7:return e.p=7,e.v,j(),M("Lookup failed. Let me take you to start a new project.","ai"),window.pendingConfirmation=null,e.n=8,C(3);case 8:e.n=10;break;case 9:"no"===n?(window.pendingConfirmation=null,M("Please tell me again what you want to do. For example: 'I want to do Cost Estimate for study SK123-KBI'.","ai")):M("I couldn't understand if you meant yes or no. Please respond with something like 'yes', 'no', 'correct', or 'not correct'.","ai");case 10:e.n=12;break;case 11:e.p=11,e.v,j(),M("Sorry, I couldn't process your response. Please say 'yes' or 'no'.","ai");case 12:return e.p=12,document.getElementById("chat-send-btn").disabled=!1,e.f(12);case 13:return e.a(2)}},e,null,[[4,7],[1,11,12,13]])}))).apply(this,arguments)}function E(e){return P.apply(this,arguments)}function P(){return(P=d(s().m(function e(t){var n,r,o;return s().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("".concat(m,"/api/v2/parse-command"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:'Parse this as yes/no intent: "'.concat(t,'". Return only "yes", "no", or "unclear".'),type:"yesno_intent"})});case 1:if((n=e.v).ok){e.n=2;break}throw new Error("Intent parsing failed");case 2:return e.n=3,n.json();case 3:if(e.v,r=t.toLowerCase().trim(),o=["no","n","nope","wrong","incorrect","false","not right","not correct","that's wrong","cancel","redo"],!["yes","y","yeah","yep","correct","right","true","ok","okay","sure","exactly","that's right","confirm","confirmed","agreed"].some(function(e){return r.includes(e)})){e.n=4;break}return e.a(2,"yes");case 4:if(!o.some(function(e){return r.includes(e)})){e.n=5;break}return e.a(2,"no");case 5:return e.a(2,"unclear")}},e)}))).apply(this,arguments)}function S(e,t){return I.apply(this,arguments)}function I(){return(I=d(s().m(function e(t,n){var r,o;return s().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("".concat(m,"/api/v2/lookup-study-task"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studyIdentifier:t,taskKey:n})});case 1:if((r=e.v).ok){e.n=2;break}throw new Error("lookup failed");case 2:return e.n=3,r.json();case 3:return o=e.v,e.a(2,(null==o?void 0:o.data)||null)}},e)}))).apply(this,arguments)}function x(e){return D.apply(this,arguments)}function D(){return(D=d(s().m(function e(t){return s().w(function(e){for(;;)switch(e.n){case 0:if(t&&!1!==t.foundStudy){e.n=2;break}return M("We could not find any records for this study. Let me take you to start a new one.","ai"),e.n=1,C(3);case 1:case 4:case 6:return e.a(2);case 2:if(!0!==t.isUnfinished||!t.documentId){e.n=5;break}return M("I found an unfinished '".concat(t.taskName,"' for study '").concat(t.studyNumber,"'. Loading it now..."),"ai"),window.currentDocumentId=t.documentId,e.n=3,Y(t.documentId);case 3:return e.n=4,T(5,d(s().m(function e(){return s().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,re(t.documentId);case 1:return e.a(2)}},e)})));case 5:return M("We could not check unfinished project for this study. Let me take you to start a new one.","ai"),e.n=6,C(3)}},e)}))).apply(this,arguments)}function C(e){return A.apply(this,arguments)}function A(){return A=d(s().m(function e(t){var n,r,o,a=arguments;return s().w(function(e){for(;;)switch(e.n){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:2e3,e.n=1,new Promise(function(e){return setTimeout(e,n)});case 1:return(r=document.createElement("div")).className="message ai-message",r.innerHTML='<div class="message-content" style="font-style: italic; color: #666; border: 1px solid #e0e0e0; background-color: #f8f9fa; padding: 8px; border-radius: 6px;">Preparing to redirect...</div>',(o=document.getElementById("chat-messages")).appendChild(r),o.scrollTop=o.scrollHeight,e.n=2,new Promise(function(e){return setTimeout(e,1e3)});case 2:r.remove(),L(t);case 3:return e.a(2)}},e)})),A.apply(this,arguments)}function T(e,t){return B.apply(this,arguments)}function B(){return B=d(s().m(function e(t,n){var r,o,a,c=arguments;return s().w(function(e){for(;;)switch(e.n){case 0:return r=c.length>2&&void 0!==c[2]?c[2]:2e3,e.n=1,new Promise(function(e){return setTimeout(e,r)});case 1:return(o=document.createElement("div")).className="message ai-message",o.innerHTML='<div class="message-content" style="font-style: italic; color: #666; border: 1px solid #e0e0e0; background-color: #f8f9fa; padding: 8px; border-radius: 6px;">Loading previous work...</div>',(a=document.getElementById("chat-messages")).appendChild(o),a.scrollTop=a.scrollHeight,e.n=2,new Promise(function(e){return setTimeout(e,1e3)});case 2:if(o.remove(),!n){e.n=3;break}return e.n=3,n();case 3:L(t);case 4:return e.a(2)}},e)})),B.apply(this,arguments)}function M(e,t){var n=document.getElementById("chat-messages"),r=document.createElement("div");r.className="message ".concat(t,"-message");var o=document.createElement("div");o.className="message-content",o.textContent=e,r.appendChild(o),n.appendChild(r),n.scrollTop=n.scrollHeight}function U(){var e=document.getElementById("chat-messages"),t=document.createElement("div");t.className="message ai-message typing-indicator",t.id="typing-indicator";var n=document.createElement("div");n.className="message-content",n.innerHTML='<strong>LLX AI:</strong> <span class="typing-dots">Thinking<span>.</span><span>.</span><span>.</span></span>',t.appendChild(n),e.appendChild(t),e.scrollTop=e.scrollHeight}function j(){var e=document.getElementById("typing-indicator");e&&e.remove()}function L(e){f=e,document.querySelectorAll(".wizard-page").forEach(function(t){var n=Number(t.getAttribute("data-step"));t.style.display=n===e?"block":"none"});var t=document.getElementById("wizard-back-btn"),n=document.getElementById("wizard-next-btn"),r=document.querySelector(".wizard-nav");1===e?r&&(r.style.display="none"):(r&&(r.style.display="flex"),t.disabled=1===e,n.disabled=!1,n.querySelector(".ms-Button-label").textContent=6===e?"Done":"Next")}function R(){return H.apply(this,arguments)}function H(){return(H=d(s().m(function e(){var t,n,r,o,a,c,i,u,l,d,p,y,g;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:if(1!==f){e.n=1;break}return L(3),e.a(2);case 1:if(3!==f){e.n=3;break}if(window.currentDocumentId){e.n=2;break}return X("Please upload a protocol document before proceeding.","error"),e.a(2);case 2:return L(5),e.a(2);case 3:if(5!==f){e.n=21;break}if(!window.currentDocumentId){e.n=7;break}return e.p=4,e.n=5,Me();case 5:e.n=7;break;case 6:e.p=6,p=e.v,console.warn("保存项目选择失败但不阻塞进入下一步:",p);case 7:return e.n=8,De();case 8:return e.n=9,Ae();case 9:if(window.currentDocumentId){e.n=10;break}return X("Missing document id. Please upload again.","error"),e.a(2);case 10:return L(4),e.p=11,e.n=12,fetch("".concat(m,"/api/documents/").concat(window.currentDocumentId,"/analyze-sdtm"),{method:"POST"});case 12:return t=e.v,e.n=13,t.json();case 13:null!=(n=e.v)&&n.success?X("SDTM analysis completed.","success"):X("SDTM analysis failed or incomplete. You can review later.","error"),e.n=15;break;case 14:e.p=14,y=e.v,console.warn("分析触发失败:",y),X("Failed to start analysis. You can review later.","error");case 15:return e.p=15,e.n=16,fetch("".concat(m,"/api/documents/").concat(window.currentDocumentId,"/content"));case 16:if(!(r=e.v).ok){e.n=18;break}return e.n=17,r.json();case 17:a=e.v,(c=null==a||null===(o=a.document)||void 0===o?void 0:o.sdtmData)&&(i=!!(c.confirmed&&c.confirmed.summary&&("number"==typeof c.confirmed.summary.total_sdtm_domains&&c.confirmed.summary.total_sdtm_domains>0||Array.isArray(c.confirmed.summary.unique_domains)&&c.confirmed.summary.unique_domains.length>0)),(u=i?c.confirmed:c.original)&&u.procedures&&se(u));case 18:e.n=20;break;case 19:e.p=19,g=e.v,console.warn("进入SDTM结果页前获取SDTM失败:",g);case 20:return L(6),e.a(2);case 21:if(6!==f){e.n=31;break}if(window.currentDocumentId){e.n=22;break}return X("Missing document id. Please upload again.","error"),e.a(2);case 22:return e.p=22,e.n=23,fetch("".concat(m,"/api/documents/").concat(window.currentDocumentId,"/mark-complete"),{method:"PATCH"});case 23:return l=e.v,e.n=24,l.json();case 24:if(null==(d=e.v)||!d.success){e.n=28;break}return X("Project completed! Saving Excel file and starting fresh...","success"),e.n=25,ke();case 25:return e.n=26,Pe();case 26:return e.n=27,Ie();case 27:e.n=29;break;case 28:X("Failed to mark as completed: "+((null==d?void 0:d.message)||""),"error");case 29:e.n=31;break;case 30:e.p=30,X("Failed to mark as completed: "+e.v.message,"error");case 31:return e.a(2)}},e,null,[[22,30],[15,19],[11,14],[4,6]])}))).apply(this,arguments)}function _(){var e=document.getElementById("protocol-select-btn"),t=document.getElementById("protocol-file-input"),n=document.getElementById("protocol-upload-area"),r=document.getElementById("protocol-cancel-btn"),o=document.getElementById("protocol-remove-btn");e.addEventListener("click",function(){return t.click()}),n.addEventListener("click",function(){return t.click()}),t.addEventListener("change",function(e){return q(e.target.files[0])}),r.addEventListener("click",K),o.addEventListener("click",W),n.addEventListener("dragover",O),n.addEventListener("drop",function(e){return function(e){e.preventDefault(),e.currentTarget.classList.remove("dragover");var t=e.dataTransfer.files;t.length>0&&q(t[0])}(e)}),n.addEventListener("dragenter",N),n.addEventListener("dragleave",F),document.querySelectorAll("[data-requires-count]").forEach(function(e){e.addEventListener("change",function(){var e=this.getAttribute("data-requires-count"),t=document.getElementById("".concat(e,"-container"));if(t)if(this.checked){t.style.display="flex";var n=t.querySelector(".count-input");n&&setTimeout(function(){return n.focus()},300)}else{t.style.display="none";var r=t.querySelector(".count-input");r&&(r.value="")}})})}function O(e){e.preventDefault(),e.dataTransfer.dropEffect="copy"}function N(e){e.preventDefault(),e.currentTarget.classList.add("dragover")}function F(e){e.preventDefault(),e.currentTarget.classList.remove("dragover")}function q(e){return z.apply(this,arguments)}function z(){return(z=d(s().m(function e(t){var n,r,o,a;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t){e.n=1;break}return e.a(2);case 1:if(["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(t.type)){e.n=2;break}return X("Please select PDF or Word documents only","error"),e.a(2);case 2:return G(),e.p=3,(n=new FormData).append("document",t),n.append("documentType","ClinicalProtocol"),e.n=4,fetch("".concat(m,"/api/upload-document"),{method:"POST",body:n});case 4:if((r=e.v).ok){e.n=5;break}throw new Error("Upload failed: ".concat(r.statusText));case 5:return e.n=6,r.json();case 6:if(o=e.v,t.name,t.size,t.type,o.uploadId,!o.uploadId){e.n=7;break}return window.currentDocumentId=o.uploadId,e.n=7,Y(o.uploadId);case 7:V(t),X("Clinical Protocol uploaded. Click Next to select projects.","success"),e.n=9;break;case 8:e.p=8,a=e.v,console.error("Protocol upload error:",a),X("Upload failed: ".concat(a.message),"error"),$();case 9:return e.a(2)}},e,null,[[3,8]])}))).apply(this,arguments)}function G(){document.getElementById("protocol-upload-area").style.display="none",document.getElementById("protocol-progress").style.display="block",document.getElementById("protocol-result").style.display="none"}function $(){document.getElementById("protocol-upload-area").style.display="block",document.getElementById("protocol-progress").style.display="none"}function V(e){document.getElementById("protocol-upload-area").style.display="none",document.getElementById("protocol-progress").style.display="none",document.getElementById("protocol-result").style.display="block",document.getElementById("protocol-file-name").textContent=e.name,document.getElementById("protocol-file-status").textContent="✅ Clinical Protocol uploaded to MongoDB"}function K(){$(),X("Protocol upload cancelled","info")}function W(){return J.apply(this,arguments)}function J(){return(J=d(s().m(function e(){return s().w(function(e){for(;;)switch(e.n){case 0:return window.currentDocumentId=null,ce=null,document.getElementById("protocol-upload-area").style.display="block",document.getElementById("protocol-result").style.display="none",document.getElementById("protocol-file-input").value="",we(),e.n=1,te();case 1:document.querySelectorAll('.project-options input[type="checkbox"]').forEach(function(e){e.checked=!1;var t=e.getAttribute("data-requires-count");if(t){var n=document.getElementById("".concat(t,"-container")),r=document.getElementById("".concat(t,"-count"));n&&(n.style.display="none"),r&&(r.value="")}}),X("Clinical Protocol removed","info");case 2:return e.a(2)}},e)}))).apply(this,arguments)}function X(e,t){var n=document.getElementById("status-message");n.textContent=e,n.className="status-message ".concat(t),"success"!==t&&"info"!==t||setTimeout(function(){n.className="status-message"},3e3)}function Y(e){return Q.apply(this,arguments)}function Q(){return Q=d(s().m(function e(t){var n;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=d(s().m(function e(n){var r;return s().w(function(e){for(;;)switch(e.n){case 0:r=n.workbook.settings;try{r.getItem("currentDocumentId").delete()}catch(e){}return r.add("currentDocumentId",t),e.n=1,n.sync();case 1:console.log("✅ 文档ID已保存到Excel设置:",t);case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,n=e.v,console.error("❌ 保存文档ID失败:",n);case 3:return e.a(2)}},e,null,[[0,2]])})),Q.apply(this,arguments)}function Z(){return ee.apply(this,arguments)}function ee(){return ee=d(s().m(function e(){var t;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=d(s().m(function e(t){var n,r;return s().w(function(e){for(;;)switch(e.n){case 0:return n=t.workbook.settings,r=n.getItem("currentDocumentId"),t.load(r,"value"),e.n=1,t.sync();case 1:if(!r.value){e.n=2;break}return console.log("✅ 从Excel设置中恢复文档ID:",r.value),e.a(2,r.value);case 2:return e.a(2,null)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2,e.v);case 2:return e.p=2,t=e.v,console.error("❌ 读取文档ID失败:",t),e.a(2,null)}},e,null,[[0,2]])})),ee.apply(this,arguments)}function te(){return ne.apply(this,arguments)}function ne(){return ne=d(s().m(function e(){var t;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=d(s().m(function e(t){return s().w(function(e){for(;;)switch(e.n){case 0:return t.workbook.settings.getItem("currentDocumentId").delete(),e.n=1,t.sync();case 1:console.log("✅ 已清除Excel设置中的文档ID");case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("❌ 清除文档ID失败:",t);case 3:return e.a(2)}},e,null,[[0,2]])})),ne.apply(this,arguments)}function re(e){return oe.apply(this,arguments)}function oe(){return(oe=d(s().m(function e(t){var n,r,o,a,c;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,window.currentDocumentId=t,X("正在恢复数据状态...","info"),e.n=1,fetch("".concat(m,"/api/documents/").concat(t,"/content"));case 1:if((n=e.v).ok){e.n=2;break}throw new Error("Failed to fetch document data");case 2:return e.n=3,n.json();case 3:if((r=e.v).success){e.n=4;break}throw new Error(r.message||"Failed to get document content");case 4:return(o=r.document).sdtmData&&(o.sdtmData.confirmed||o.sdtmData.original)&&(a=o.sdtmData.confirmed||o.sdtmData.original)&&a.procedures&&(se(ce={success:!0,procedures:a.procedures,mappings:a.mappings||[],summary:a.summary||{}}),X("SDTM分析数据已恢复","success")),o.projectSelectionDetails&&ae(o.projectSelectionDetails),e.n=5,De();case 5:return e.n=6,Ae();case 6:X("所有数据状态已成功恢复！","success"),e.n=8;break;case 7:e.p=7,c=e.v,console.error("❌ 恢复应用状态失败:",c),X("恢复数据状态失败: "+c.message,"error");case 8:return e.a(2)}},e,null,[[0,7]])}))).apply(this,arguments)}function ae(e){try{var t=document.querySelectorAll('.project-options input[type="checkbox"]');t.forEach(function(e){e.checked=!1;var t=e.getAttribute("data-requires-count");if(t){var n=document.getElementById("".concat(t,"-container"));n&&(n.style.display="none")}}),Object.entries(e).forEach(function(e){var n=a(e,2),r=n[0],o=n[1];if("lastUpdated"!==r){var c=Array.from(t).find(function(e){var t=e.nextElementSibling;if(t&&t.classList.contains("ms-CheckBox-label")){var n=t.querySelector(".ms-CheckBox-text");return n&&n.textContent.trim()===r}return!1});if(c){c.checked=!0;var i=c.getAttribute("data-requires-count");if(i&&o&&o>0){var s=document.getElementById("".concat(i,"-container")),u=document.getElementById("".concat(i,"-count"));s&&u&&(s.style.display="flex",u.value=o)}}}}),console.log("✅ 项目选择状态已恢复")}catch(e){console.error("❌ 恢复项目选择状态失败:",e)}}Office.onReady,Office.onReady(function(){var e=d(s().m(function e(t){var n,r;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t.host!==Office.HostType.Excel){e.n=7;break}return document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="flex",p(),_(),e.p=1,e.n=2,Z();case 2:if(!(n=e.v)){e.n=4;break}return e.n=3,re(n);case 3:L(5),e.n=5;break;case 4:L(1);case 5:e.n=7;break;case 6:e.p=6,r=e.v,console.error("❌ 启动时恢复状态失败:",r),L(1);case 7:return e.a(2)}},e,null,[[1,6]])}));return function(t){return e.apply(this,arguments)}}());var ce=null,ie=!1;function se(e){console.log("显示SDTM分析结果:",e);var t=e&&(!0===e.success||void 0===e.success&&Array.isArray(e.procedures)&&e.procedures.length>0);ce={success:!0===t,procedures:o(e.procedures||[]),mappings:o(e.mappings||[]),summary:n({},e.summary||{})};var r=document.getElementById("sdtm-analysis-section"),a=document.getElementById("sdtm-status"),c=document.getElementById("sdtm-status-text"),i=document.getElementById("sdtm-mappings-container");r.style.display="block",!0===ce.success?(a.style.display="block",a.className="sdtm-status success",c.textContent="SDTM analysis completed successfully - Please review and confirm",fe(),ce.mappings&&ce.mappings.length,i.style.display="block",ue(ce),function(){var e=document.getElementById("edit-mappings-btn");e&&e.addEventListener("click",me);var t=document.getElementById("confirm-mappings-btn");t&&t.addEventListener("click",pe)}()):(a.style.display="block",a.className="sdtm-status error",c.textContent=e.message||"SDTM analysis failed")}function ue(e){var t=document.getElementById("flat-mappings-list");t.innerHTML="",e.procedures&&0!==e.procedures.length?e.procedures.forEach(function(n,r){var o=e.mappings?e.mappings.find(function(e){return e.procedure===n}):null,a=function(e,t){var n=document.createElement("div");n.className="mapping-row",n.dataset.index=t;var r=document.createElement("div");r.className="procedure-name",r.textContent=e.procedure;var o=document.createElement("div");o.className="domains-area",e.sdtm_domains&&e.sdtm_domains.length>0&&e.sdtm_domains.forEach(function(e,n){var r=le(e,t,n);o.appendChild(r)});var a=document.createElement("div");return a.className="add-domain-btn",a.innerHTML="+ Add",a.addEventListener("click",function(){return function(e){if(ie){var t=ce.procedures[e];if(t){var n=ce.mappings.find(function(e){return e.procedure===t});n||(n={procedure:t,sdtm_domains:[]},ce.mappings.push(n)),n.sdtm_domains.push("");var r=n.sdtm_domains.length-1;ue(ce),ie&&(me(),me()),setTimeout(function(){var t=document.querySelector('[data-mapping-index="'.concat(e,'"][data-domain-index="').concat(r,'"]'));t&&de(t)},100)}}}(t)}),o.appendChild(a),n.appendChild(r),n.appendChild(o),n}({procedure:n,sdtm_domains:o?o.sdtm_domains:[]},r);t.appendChild(a)}):t.innerHTML='<div style="text-align: center; color: #666; padding: 20px;">No procedures found</div>'}function le(e,t,n){var r=document.createElement("span");r.className="editable-domain-tag",r.textContent=e,r.dataset.mappingIndex=t,r.dataset.domainIndex=n;var o=document.createElement("span");return o.className="remove-domain-btn",o.innerHTML="×",o.addEventListener("click",function(e){e.stopPropagation(),function(e,t){var n=ce.procedures[e];if(n){var r=ce.mappings.find(function(e){return e.procedure===n});r&&r.sdtm_domains&&void 0!==r.sdtm_domains[t]&&(r.sdtm_domains.splice(t,1),ue(ce),ie&&(me(),me()),fe())}}(t,n)}),r.appendChild(o),r.addEventListener("click",function(){ie&&de(r)}),r}function de(e){if("true"!==e.contentEditable){var t=e.textContent.replace("×","").trim();e.innerHTML=t,e.contentEditable="true",e.classList.add("editing"),e.focus();var n=document.createRange();n.selectNodeContents(e);var r=window.getSelection();r.removeAllRanges(),r.addRange(n);var o=function(){e.contentEditable="false",e.classList.remove("editing");var t=e.textContent.trim(),n=parseInt(e.dataset.mappingIndex),r=parseInt(e.dataset.domainIndex);t&&ce.mappings[n]&&(ce.mappings[n].sdtm_domains[r]=t);var o=le(t,n,r);e.parentNode.replaceChild(o,e),fe()};e.addEventListener("blur",o),e.addEventListener("keydown",function(n){"Enter"===n.key?(n.preventDefault(),o()):"Escape"===n.key&&(n.preventDefault(),e.textContent=t,o())})}}function me(){ie=!ie;var e=document.getElementById("edit-mappings-btn"),t=document.getElementById("flat-mappings-list");e&&(e.querySelector(".ms-Button-label").textContent=ie?"View Mode":"Edit"),ie?(t.classList.add("edit-mode"),document.querySelectorAll(".mapping-row").forEach(function(e){e.classList.add("edit-mode")})):(t.classList.remove("edit-mode"),document.querySelectorAll(".mapping-row").forEach(function(e){e.classList.remove("edit-mode")}))}function fe(){var e=new Map;Array.isArray(ce.mappings)&&ce.mappings.forEach(function(t){var n=t&&"High"===t.complexity?"High":"Medium";(Array.isArray(null==t?void 0:t.sdtm_domains)?t.sdtm_domains:[]).forEach(function(t){var r=(t||"").trim();if(r){var o=e.get(r);o?"Medium"===o&&"High"===n&&e.set(r,"High"):e.set(r,n)}})});var t=Array.from(e.keys()),n=t.filter(function(t){return"High"===e.get(t)}),r=t.filter(function(t){return"Medium"===e.get(t)});ce.summary.total_procedures=ce.procedures?ce.procedures.length:0,ce.summary.unique_domains=t,ce.summary.total_sdtm_domains=t.length,ce.summary.highComplexitySdtm={count:n.length,domains:n},ce.summary.mediumComplexitySdtm={count:r.length,domains:r},function(e){document.getElementById("total-procedures").textContent=e.total_procedures||0,document.getElementById("total-domains").textContent=e.total_sdtm_domains||0;var t=document.getElementById("domains-list-overview");t.innerHTML="",e.unique_domains&&e.unique_domains.length>0&&e.unique_domains.forEach(function(e){var n=document.createElement("span");n.className="domain-overview-tag",n.textContent=e,t.appendChild(n)});var n=document.getElementById("high-complexity-domains");n.innerHTML="",e.highComplexitySdtm&&e.highComplexitySdtm.domains&&e.highComplexitySdtm.domains.length>0&&e.highComplexitySdtm.domains.forEach(function(e){var t=document.createElement("span");t.className="domain-overview-tag",t.textContent=e,n.appendChild(t)});var r=document.getElementById("medium-complexity-domains");r.innerHTML="",e.mediumComplexitySdtm&&e.mediumComplexitySdtm.domains&&e.mediumComplexitySdtm.domains.length>0&&e.mediumComplexitySdtm.domains.forEach(function(e){var t=document.createElement("span");t.className="domain-overview-tag",t.textContent=e,r.appendChild(t)})}(ce.summary),console.log("统计数据已更新:",{total_procedures:ce.summary.total_procedures,total_sdtm_domains:ce.summary.total_sdtm_domains,unique_domains:ce.summary.unique_domains,highComplexitySdtm:ce.summary.highComplexitySdtm,mediumComplexitySdtm:ce.summary.mediumComplexitySdtm})}function pe(){return ye.apply(this,arguments)}function ye(){return(ye=d(s().m(function e(){var t,n,r,o,a,c,i,u,l,d,f,p,y,g,h,v,b;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:if(window.currentDocumentId){e.n=1;break}return alert("No document ID found. Please re-upload the document."),e.a(2);case 1:if(ce&&Array.isArray(ce.procedures)){e.n=2;break}return X("No SDTM data to confirm.","error"),e.a(2);case 2:return e.p=2,console.log("发送确认请求到服务器..."),e.n=3,fetch("".concat(m,"/api/documents/").concat(window.currentDocumentId,"/confirm-sdtm"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({procedures:ce.procedures||[],mappings:ce.mappings||[],summary:ce.summary||{}})});case 3:return t=e.v,e.n=4,t.json();case 4:if(!(n=e.v).success){e.n=13;break}if(console.log("SDTM分析已确认并保存"),(o=document.getElementById("confirmation-status"))&&(o.style.display="flex"),a=document.getElementById("edit-mappings-btn"),c=document.getElementById("confirm-mappings-btn"),a&&(a.style.display="none"),c&&(c.style.display="none"),X("SDTM analysis confirmed and saved successfully!","success"),i=null==n||null===(r=n.data)||void 0===r?void 0:r.costEstimate,u=null,!i||!i["SDTM Datasets Production and Validation"]){e.n=5;break}return e.n=5,ge(i["SDTM Datasets Production and Validation"]);case 5:return e.p=5,e.n=6,fetch("".concat(m,"/api/documents/").concat(window.currentDocumentId,"/content"));case 6:if(!(l=e.v).ok){e.n=9;break}return e.n=7,l.json();case 7:if(p=e.v,y=null==p||null===(d=p.document)||void 0===d||null===(d=d.costEstimate)||void 0===d?void 0:d["SDTM Datasets Production and Validation"],i||!y){e.n=8;break}return e.n=8,ge(y);case 8:(g=null==p||null===(f=p.document)||void 0===f?void 0:f.sdtmData)&&(h=!!(g.confirmed&&g.confirmed.summary&&("number"==typeof g.confirmed.summary.total_sdtm_domains&&g.confirmed.summary.total_sdtm_domains>0||Array.isArray(g.confirmed.summary.unique_domains)&&g.confirmed.summary.unique_domains.length>0)),u=h?g.confirmed:g.original);case 9:e.n=11;break;case 10:e.p=10,v=e.v,console.warn("无法获取文档用于写入Notes:",v);case 11:if(!u){e.n=12;break}return e.n=12,ve(u);case 12:e.n=14;break;case 13:console.error("确认失败:",n.message),X("Failed to confirm SDTM analysis: "+n.message,"error");case 14:e.n=16;break;case 15:e.p=15,b=e.v,console.error("确认请求失败:",b),X("Network error: Failed to confirm SDTM analysis","error");case 16:return e.a(2)}},e,null,[[5,10],[2,15]])}))).apply(this,arguments)}function ge(e){return he.apply(this,arguments)}function he(){return he=d(s().m(function e(t){var n,r;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:return n={"SDTM Annotated CRFs (aCRF)":"annotatedCrf","SDTM Dataset Specs (High Complexity)":"specsHigh","SDTM Dataset Specs (Medium Complexity)":"specsMedium","SDTM Production and Validation: Programs and Datasets (High Complexity)":"prodHigh","SDTM Production and Validation: Programs and Datasets (Medium Complexity)":"prodMedium","SDTM Pinnacle 21 Report Creation and Review":"pinnacle21","SDTM Reviewer's Guide":"reviewersGuide","SDTM Define.xml":"defineXml","SDTM Dataset File xpt Conversion and Review":"xptConversion"},e.p=1,e.n=2,Excel.run(function(){var e=d(s().m(function e(r){var o,a,c,i,u,l,d,m,f,p,y,g,h,v,b,w,k,E,P,S,I,x;return s().w(function(e){for(;;)switch(e.n){case 0:return a=r.workbook.worksheets.getActiveWorksheet(),(c=a.getUsedRange()).load(["values","rowIndex","columnIndex"]),e.n=1,r.sync();case 1:i=c.rowIndex||0,u=c.columnIndex||0,l=c.values,d=t.units||{},m=t.estimatedCosts||{},f=null!==(o=t.subtotal)&&void 0!==o?o:null,p=0;case 2:if(!(p<l.length)){e.n=5;break}if(h=String(l[p][0]||"").trim(),n.hasOwnProperty(h)){e.n=3;break}return e.a(3,4);case 3:v=n[h],b=null!==(y=d[v])&&void 0!==y?y:"",w=null!==(g=m[v])&&void 0!==g?g:"",k=a.getRangeByIndexes(i+p,u+1,1,1),E=a.getRangeByIndexes(i+p,u+5,1,1),k.values=[[""===b?"":Number(b)]],k.format.horizontalAlignment="Right",E.values=[[""===w?"":"$".concat(Number(w))]],E.format.horizontalAlignment="Right";case 4:p++,e.n=2;break;case 5:if(null===f){e.n=11;break}P=-1,S=0;case 6:if(!(S<l.length)){e.n=8;break}if("sdtm datasets production and validation"!==String(l[S][0]||"").trim().toLowerCase()){e.n=7;break}return P=S,e.a(3,8);case 7:S++,e.n=6;break;case 8:if(!(P>=0)){e.n=11;break}I=P+1;case 9:if(!(I<l.length)){e.n=11;break}if("subtotal"!==String(l[I][0]||"").trim().toLowerCase()){e.n=10;break}return(x=a.getRangeByIndexes(i+I,u+5,1,1)).values=[["$".concat(Number(f))]],x.format.horizontalAlignment="Right",e.a(3,11);case 10:I++,e.n=9;break;case 11:return e.n=12,r.sync();case 12:X("Units, estimated costs and subtotal applied from confirmed SDTM data.","success");case 13:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,r=e.v,console.error("写入Excel的SDTM单元与成本失败:",r),X("Failed to write units/costs/subtotal to Excel: "+r.message,"error");case 4:return e.a(2)}},e,null,[[1,3]])})),he.apply(this,arguments)}function ve(e){return be.apply(this,arguments)}function be(){return be=d(s().m(function e(t){var n,r,o,a,c,i,u,l;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,a=(null==t||null===(n=t.summary)||void 0===n||null===(n=n.highComplexitySdtm)||void 0===n?void 0:n.domains)||[],c=(null==t||null===(r=t.summary)||void 0===r||null===(r=r.mediumComplexitySdtm)||void 0===r?void 0:r.domains)||[],i=(null==t||null===(o=t.summary)||void 0===o?void 0:o.unique_domains)||[],u={"SDTM Dataset Specs (High Complexity)":a.join("/"),"SDTM Dataset Specs (Medium Complexity)":c.join("/"),"SDTM Dataset File xpt Conversion and Review":i.join("/")},e.n=1,Excel.run(function(){var e=d(s().m(function e(t){var n,r,o,a,c,i,l,d,m;return s().w(function(e){for(;;)switch(e.n){case 0:return n=t.workbook.worksheets.getActiveWorksheet(),(r=n.getUsedRange()).load(["values","rowIndex","columnIndex"]),e.n=1,t.sync();case 1:o=r.rowIndex||0,a=r.columnIndex||0,c=r.values,i=0;case 2:if(!(i<c.length)){e.n=5;break}if((l=String(c[i][0]||"").trim())in u){e.n=3;break}return e.a(3,4);case 3:d=u[l]||"",(m=n.getRangeByIndexes(o+i,a+6,1,1)).values=[[d]],m.format.horizontalAlignment="Left";case 4:i++,e.n=2;break;case 5:return e.n=6,t.sync();case 6:X("Notes updated from SDTM confirmed data.","success");case 7:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,l=e.v,console.error("写入SDTM Notes失败:",l),X("Failed to write SDTM notes: "+l.message,"error");case 3:return e.a(2)}},e,null,[[0,2]])})),be.apply(this,arguments)}function we(){var e=document.getElementById("sdtm-analysis-section"),t=document.getElementById("sdtm-mappings-container");e&&(e.style.display="none"),t&&(t.style.display="none"),ce=null,window.currentDocumentId=null,ie=!1}function ke(){return Ee.apply(this,arguments)}function Ee(){return Ee=d(s().m(function e(){var t;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=d(s().m(function e(t){var n,r,o,a;return s().w(function(e){for(;;)switch(e.n){case 0:return n=t.workbook,r=new Date,o=r.toISOString().replace(/[:.]/g,"-").slice(0,19),a="LLX_Cost_Analysis_".concat(o,".xlsx"),n.save(),e.n=1,t.sync();case 1:console.log("✅ Excel文件已保存:",a),X("Excel file saved successfully!","success");case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("❌ 保存Excel失败:",t),X("Failed to save Excel: "+t.message,"error");case 3:return e.a(2)}},e,null,[[0,2]])})),Ee.apply(this,arguments)}function Pe(){return Se.apply(this,arguments)}function Se(){return Se=d(s().m(function e(){var t;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=d(s().m(function e(t){var n,r;return s().w(function(e){for(;;)switch(e.n){case 0:if(n=t.workbook.worksheets.getActiveWorksheet(),!(r=n.getUsedRange())){e.n=1;break}return r.clear(),e.n=1,t.sync();case 1:console.log("✅ Excel内容已清空"),X("Excel content cleared for new project!","success");case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("❌ 清空Excel失败:",t),X("Failed to clear Excel: "+t.message,"error");case 3:return e.a(2)}},e,null,[[0,2]])})),Se.apply(this,arguments)}function Ie(){return xe.apply(this,arguments)}function xe(){return(xe=d(s().m(function e(){var t;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,window.currentDocumentId=null,ce=null,ie=!1,e.n=1,te();case 1:document.querySelectorAll('.project-options input[type="checkbox"]').forEach(function(e){e.checked=!1;var t=e.getAttribute("data-requires-count");if(t){var n=document.getElementById("".concat(t,"-container")),r=document.getElementById("".concat(t,"-count"));n&&(n.style.display="none"),r&&(r.value="")}}),document.getElementById("protocol-upload-area").style.display="block",document.getElementById("protocol-progress").style.display="none",document.getElementById("protocol-result").style.display="none",document.getElementById("protocol-file-input").value="",we(),L(1),console.log("✅ 应用状态已重置"),X("Ready for new project!","success"),e.n=3;break;case 2:e.p=2,t=e.v,console.error("❌ 重置状态失败:",t),X("Failed to reset: "+t.message,"error");case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function De(){return Ce.apply(this,arguments)}function Ce(){return Ce=d(s().m(function e(){var t;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=d(s().m(function e(t){var n,r,o;return s().w(function(e){for(;;)switch(e.n){case 0:return n=t.workbook.worksheets.getActiveWorksheet(),r=["Task","Unit","Cost Per Hour","# of Hours Per Unit","Cost Per Unit","Estimated cost","Notes"],(o=n.getRange("A1:G1")).values=[r],o.format.font.bold=!0,o.format.font.size=12,o.format.fill.color="#E7E7E7",o.format.borders.getItem("EdgeTop").style="Continuous",o.format.borders.getItem("EdgeBottom").style="Continuous",o.format.borders.getItem("EdgeLeft").style="Continuous",o.format.borders.getItem("EdgeRight").style="Continuous",o.format.borders.getItem("InsideVertical").style="Continuous",o.format.autofitColumns(),e.n=1,t.sync();case 1:console.log("✅ 标准成本分析表格标题已创建"),X("Excel table headers created successfully!","success");case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("❌ 创建Excel标题时出错:",t),X("Failed to create Excel headers: "+t.message,"error");case 3:return e.a(2)}},e,null,[[0,2]])})),Ce.apply(this,arguments)}function Ae(){return Te.apply(this,arguments)}function Te(){return Te=d(s().m(function e(){var t,n,r,o,c,i,u,l,f,p,y,g,h;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,o={},c=null,!window.currentDocumentId){e.n=6;break}return e.p=1,e.n=2,fetch("".concat(m,"/api/documents/").concat(window.currentDocumentId,"/content"));case 2:if(!(i=e.v).ok){e.n=4;break}return e.n=3,i.json();case 3:(u=e.v).document&&u.document.projectSelectionDetails&&(o=u.document.projectSelectionDetails),u.document&&u.document.sdtmData&&(l=u.document.sdtmData,f=!!(l.confirmed&&l.confirmed.summary&&("number"==typeof l.confirmed.summary.total_sdtm_domains&&l.confirmed.summary.total_sdtm_domains>0||Array.isArray(l.confirmed.summary.unique_domains)&&l.confirmed.summary.unique_domains.length>0)),c=f?l.confirmed:l.original);case 4:e.n=6;break;case 5:e.p=5,g=e.v,console.warn("无法获取已保存的项目详情，使用当前选择:",g);case 6:return 0===Object.keys(o).length&&(p=Be(),y=p.projectSelectionDetails,o=y),null===(t=c)||void 0===t||null===(t=t.summary)||void 0===t||null===(t=t.highComplexitySdtm)||void 0===t||t.count,null===(n=c)||void 0===n||null===(n=n.summary)||void 0===n||null===(n=n.mediumComplexitySdtm)||void 0===n||n.count,null===(r=c)||void 0===r||null===(r=r.summary)||void 0===r||r.total_sdtm_domains,e.n=7,Excel.run(function(){var e=d(s().m(function e(t){var n,r,c,i,u,l,d,m,f,p,y,g,h,v,b,w,k,E,P,S,I,x,D,C,A,T,B,M,U,j,L,R,H,_,O,N,F,q,z,G,$,V,K,W,J,X,Y,Q,Z,ee,te;return s().w(function(e){for(;;)switch(e.n){case 0:if(n=t.workbook.worksheets.getActiveWorksheet(),r=2,!(Object.keys(o).length>0)){e.n=4;break}c=0,i=Object.entries(o);case 1:if(!(c<i.length)){e.n=4;break}if(u=a(i[c],2),l=u[0],d=u[1],"lastUpdated"!==l){e.n=2;break}return e.a(3,3);case 2:if(m=l.toLowerCase().includes("sdtm"),f=l.toLowerCase().includes("adam"),p=l.toLowerCase().includes("dsur"),y=l.toLowerCase().includes("dsmb"),g=l.toLowerCase().includes("statistical analysis plan"),m||f||g){if((h=n.getRange("A".concat(r,":G").concat(r))).values=[[l,"","","","","",""]],h.format.font.bold=!0,h.format.horizontalAlignment="Left",r++,m)for(v=0,b=[{name:"SDTM Annotated CRFs (aCRF)",unit:"",costPerHour:1,hoursPerUnit:32,costPerUnit:32},{name:"SDTM Dataset Specs (High Complexity)",unit:"",costPerHour:1,hoursPerUnit:3,costPerUnit:3},{name:"SDTM Dataset Specs (Medium Complexity)",unit:"",costPerHour:1,hoursPerUnit:2,costPerUnit:2},{name:"SDTM Production and Validation: Programs and Datasets (High Complexity)",unit:"",costPerHour:1,hoursPerUnit:16,costPerUnit:16},{name:"SDTM Production and Validation: Programs and Datasets (Medium Complexity)",unit:"",costPerHour:1,hoursPerUnit:10,costPerUnit:10},{name:"SDTM Pinnacle 21 Report Creation and Review",unit:"",costPerHour:1,hoursPerUnit:6,costPerUnit:6},{name:"SDTM Reviewer's Guide",unit:"",costPerHour:1,hoursPerUnit:32,costPerUnit:32},{name:"SDTM Define.xml",unit:"",costPerHour:1,hoursPerUnit:32,costPerUnit:32},{name:"SDTM Dataset File xpt Conversion and Review",unit:"",costPerHour:1,hoursPerUnit:.2,costPerUnit:.2}];v<b.length;v++)w=b[v],(k=n.getRange("A".concat(r,":G").concat(r))).values=[[w.name,"","$".concat(w.costPerHour),w.hoursPerUnit,"$".concat(w.costPerUnit),"",""]],(E=n.getRange("F".concat(r))).formulas=[["=B".concat(r,"*C").concat(r,"*D").concat(r)]],E.format.numberFormat=[["$#,##0.00"]],k.format.font.bold=!1,k.format.horizontalAlignment="Left",n.getRange("B".concat(r,":F").concat(r)).format.horizontalAlignment="Right",r++;else if(f)for(P=0,S=[{name:"ADaM Dataset Specs (High Complexity)",unit:"",costPerHour:1,hoursPerUnit:3,costPerUnit:3},{name:"ADaM Dataset Specs (Medium Complexity)",unit:"",costPerHour:1,hoursPerUnit:2,costPerUnit:2},{name:"ADaM Production and Validation: Programs and Datasets (High Complexity)",unit:"",costPerHour:1,hoursPerUnit:18,costPerUnit:18},{name:"ADaM Production and Validation: Programs and Datasets (Medium Complexity)",unit:"",costPerHour:1,hoursPerUnit:10,costPerUnit:10},{name:"ADaM Pinnacle 21 Report Creation and Review",unit:"",costPerHour:1,hoursPerUnit:4,costPerUnit:4},{name:"ADaM Reviewer's Guide",unit:"",costPerHour:1,hoursPerUnit:32,costPerUnit:32},{name:"ADaM Define.xml",unit:"",costPerHour:1,hoursPerUnit:32,costPerUnit:32},{name:"ADaM Dataset Program xpt Conversion and Review",unit:"",costPerHour:1,hoursPerUnit:.2,costPerUnit:.2},{name:"ADaM Program txt Conversion and Review",unit:"",costPerHour:1,hoursPerUnit:.2,costPerUnit:.2}];P<S.length;P++)I=S[P],(x=n.getRange("A".concat(r,":G").concat(r))).values=[[I.name,"","$".concat(I.costPerHour),I.hoursPerUnit,"$".concat(I.costPerUnit),"",""]],(D=n.getRange("F".concat(r))).formulas=[["=B".concat(r,"*C").concat(r,"*D").concat(r)]],D.format.numberFormat=[["$#,##0.00"]],x.format.font.bold=!1,x.format.horizontalAlignment="Left",n.getRange("B".concat(r,":F").concat(r)).format.horizontalAlignment="Right",r++;else if(g)for(C=0,A=[{name:"Statistical Analysis Plan Draft 1",unit:"",costPerHour:1,hoursPerUnit:40,costPerUnit:40},{name:"Statistical Analysis Plan Draft 2",unit:"",costPerHour:1,hoursPerUnit:30,costPerUnit:30},{name:"Statistical Analysis Plan Final",unit:"",costPerHour:1,hoursPerUnit:20,costPerUnit:20},{name:"Analysis Shells Development",unit:"",costPerHour:1,hoursPerUnit:60,costPerUnit:60},{name:"Mock Tables, Listings, and Figures",unit:"",costPerHour:1,hoursPerUnit:40,costPerUnit:40}];C<A.length;C++)T=A[C],(B=n.getRange("A".concat(r,":G").concat(r))).values=[[T.name,"","$".concat(T.costPerHour),T.hoursPerUnit,"$".concat(T.costPerUnit),"",""]],(M=n.getRange("F".concat(r))).formulas=[["=B".concat(r,"*C").concat(r,"*D").concat(r)]],M.format.numberFormat=[["$#,##0.00"]],B.format.font.bold=!1,B.format.horizontalAlignment="Left",n.getRange("B".concat(r,":F").concat(r)).format.horizontalAlignment="Right",r++;if((U=n.getRange("A".concat(r,":G").concat(r))).values=[["Subtotal","","","","","",""]],j=r-(m||f?9:g?5:1),L=r-1,(R=n.getRange("F".concat(r))).formulas=[["=SUM(F".concat(j,":F").concat(L,")")]],R.format.numberFormat=[["$#,##0.00"]],R.format.font.bold=!0,U.format.font.bold=!0,U.format.horizontalAlignment="Right",r++,d&&d>0&&(m||f)){for(H=m?"SDTM Dataset Transfer (".concat(d," times)"):"ADAM Dataset Transfer (".concat(d," times)"),(_=n.getRange("A".concat(r,":G").concat(r))).values=[[H,"","","","","",""]],_.format.font.bold=!0,_.format.horizontalAlignment="Left",r++,O=m?[{name:"Production and Validation, the first 2 times",unit:2,costPerHour:1,hoursPerUnit:25,costPerUnit:25},{name:"Production and Validation, the last ".concat(d-2," times"),unit:d-2,costPerHour:1,hoursPerUnit:12.5,costPerUnit:12.5}]:[{name:"Production and Validation, the first 2 times",unit:2,costPerHour:1,hoursPerUnit:15,costPerUnit:15},{name:"Production and Validation, the last ".concat(d-2," times"),unit:d-2,costPerHour:1,hoursPerUnit:7.5,costPerUnit:7.5}],N=0,F=O;N<F.length;N++)q=F[N],(z=n.getRange("A".concat(r,":G").concat(r))).values=[[q.name,"","$".concat(q.costPerHour),q.hoursPerUnit,"$".concat(q.costPerUnit),"",""]],z.format.font.bold=!1,z.format.horizontalAlignment="Left",n.getRange("B".concat(r,":F").concat(r)).format.horizontalAlignment="Right",r++;(G=n.getRange("A".concat(r,":G").concat(r))).values=[["Subtotal","","","","","",""]],G.format.font.bold=!0,G.format.horizontalAlignment="Right",r++}}else p||y?d&&d>0&&($=p?"DSUR Rerun (".concat(d," times)"):"DSMB Rerun (".concat(d," times)"),(V=n.getRange("A".concat(r,":G").concat(r))).values=[[$,"","","","","",""]],V.format.font.bold=!0,V.format.horizontalAlignment="Left",r++,(K=n.getRange("A".concat(r,":G").concat(r))).values=[["Subtotal","","","","","",""]],K.format.font.bold=!0,K.format.horizontalAlignment="Right",r++):((W=n.getRange("A".concat(r,":G").concat(r))).values=[[l,"","","","","",""]],W.format.font.bold=!0,W.format.horizontalAlignment="Left",r++,(J=n.getRange("A".concat(r,":G").concat(r))).values=[["Subtotal","","","","","",""]],J.format.font.bold=!0,J.format.horizontalAlignment="Right",r++);case 3:c++,e.n=1;break;case 4:for(X=0,Y=["License Fees","Adhoc Analysis","Project Management/Administration(12 Months)"];X<Y.length;X++)Q=Y[X],(Z=n.getRange("A".concat(r,":G").concat(r))).values=[[Q,"","","","","",""]],Z.format.font.bold=!0,Z.format.horizontalAlignment="Left",r++,(ee=n.getRange("A".concat(r,":G").concat(r))).values=[["Subtotal","","","","","",""]],ee.format.font.bold=!0,ee.format.horizontalAlignment="Right",r++;(te=n.getRange("A".concat(r,":G").concat(r))).values=[["Grand Total","","","","","",""]],te.format.font.bold=!0,te.format.horizontalAlignment="Right";case 5:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 7:e.n=9;break;case 8:e.p=8,h=e.v,console.error("填充Excel任务列表失败:",h),X("Failed to populate Excel: "+h.message,"error");case 9:return e.a(2)}},e,null,[[1,5],[0,8]])})),Te.apply(this,arguments)}function Be(){var e={};return document.querySelectorAll(".ms-CheckBox-input").forEach(function(t){if(t.checked){var n=t.parentElement.querySelector(".ms-CheckBox-text").textContent.trim(),r=null,o=t.getAttribute("data-requires-count");if(o){var a=document.getElementById("".concat(o,"-count"));a&&a.value&&(r=parseInt(a.value))}e[n]=r}}),{projectSelectionDetails:e}}function Me(){return Ue.apply(this,arguments)}function Ue(){return(Ue=d(s().m(function e(){var t,n,r;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,window.currentDocumentId){e.n=1;break}return console.warn("没有当前文档ID，跳过保存项目选择详情"),e.a(2);case 1:if(t=Be(),n=t.projectSelectionDetails,0!==Object.keys(n).length){e.n=2;break}return console.log("没有项目选择，跳过保存"),e.a(2);case 2:return e.n=3,fetch("".concat(m,"/api/documents/").concat(window.currentDocumentId,"/project-selection"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectSelectionDetails:n})});case 3:if(!e.v.ok){e.n=4;break}console.log("✅ 项目选择详情已自动保存"),X("Project selection automatically saved with document!","success"),e.n=5;break;case 4:throw new Error("保存项目选择详情失败");case 5:e.n=7;break;case 6:e.p=6,r=e.v,console.error("❌ 保存项目选择详情时出错:",r);case 7:return e.a(2)}},e,null,[[0,6]])}))).apply(this,arguments)}}(),function(){"use strict";new URL(n(58394),n.b)}()}();
//# sourceMappingURL=taskpane.js.map